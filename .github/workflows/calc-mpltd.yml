name: Calculate Amplitudes

on:
  repository_dispatch:
    types: [calc-mpltd]

jobs:
  assign-complex-amplitudes:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.client_payload.branch }}

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install Dependencies
        run: pip install numpy

      - name: Calculate Magnitudes and Phases
        run: |
          # Reads 'llm.txt' and calculates complex amplitudes for test cases.
          # Outputs 'tca.json' which includes:
          # - Magnitude: Based on risk/complexity
          # - Phase: Based on change nature (for interference modeling)
          python scripts/calculate_amplitudes.py

      - name: Commit TCA JSON
        run: |
          git config --global user.name 'JTopas Automation'
          git config --global user.email 'automation@jtopas.local'
          git add tca.json
          # This commit triggers GAS to detect 'tca.json' and fire 'qi-pso'
          git commit -m "chore: update tca.json [skip ci]"
          git push
